<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct Search</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="puppy-decoration top-left">
            <svg viewBox="0 0 100 100" class="puppy-svg">
                <path d="M50 20 C30 20, 20 40, 20 60 C20 80, 40 90, 50 90 C60 90, 80 80, 80 60 C80 40, 70 20, 50 20" fill="#FFD700"/>
                <circle cx="35" cy="45" r="5" fill="#000"/>
                <circle cx="65" cy="45" r="5" fill="#000"/>
                <path d="M40 65 C45 75, 55 75, 60 65" stroke="#000" stroke-width="2" fill="none"/>
            </svg>
        </div>
        <h1>Direct Search</h1>
        <div class="search-container">
            <!-- YouTube Search Box -->
            <div class="search-box youtube-box">
                <div class="search-header">
                    <img src="https://www.youtube.com/favicon.ico" alt="YouTube" class="platform-icon">
                    <h3>YouTube</h3>
                </div>
                <div class="search-input-group">
                    <input type="text" id="youtubeSearch" placeholder="Search YouTube...">
                    <button onclick="performSearch('youtube', event)" class="search-button youtube-btn">
                        Search
                    </button>
                </div>
            </div>

            <!-- Xiaohongshu Search Box -->
            <div class="search-box xiaohongshu-box">
                <div class="search-header">
                    <img src="https://www.xiaohongshu.com/favicon.ico" alt="Xiaohongshu" class="platform-icon">
                    <h3>小红书</h3>
                </div>
                <div class="search-input-group">
                    <input type="text" id="xiaohongshuSearch" placeholder="Search 小红书...">
                    <button onclick="performSearch('xiaohongshu', event)" class="search-button xiaohongshu-btn">
                        Search
                    </button>
                </div>
            </div>

            <!-- Bilibili Search Box -->
            <div class="search-box bilibili-box">
                <div class="search-header">
                    <img src="https://www.bilibili.com/favicon.ico" alt="Bilibili" class="platform-icon">
                    <h3>Bilibili</h3>
                </div>
                <div class="search-input-group">
                    <input type="text" id="bilibiliSearch" placeholder="Search Bilibili...">
                    <button onclick="performSearch('bilibili', event)" class="search-button bilibili-btn">
                        Search
                    </button>
                </div>
            </div>
        </div>
        <div class="puppy-decoration bottom-right">
            <svg viewBox="0 0 100 100" class="puppy-svg">
                <path d="M50 20 C30 20, 20 40, 20 60 C20 80, 40 90, 50 90 C60 90, 80 80, 80 60 C80 40, 70 20, 50 20" fill="#FFB6C1"/>
                <circle cx="35" cy="45" r="5" fill="#000"/>
                <circle cx="65" cy="45" r="5" fill="#000"/>
                <path d="M40 65 C45 75, 55 75, 60 65" stroke="#000" stroke-width="2" fill="none"/>
            </svg>
        </div>
    </div>
    <script>
        function performSearch(platform, event) {
            // Prevent the default button behavior
            console.log("Platform:" + platform);
            console.log("Event:" + event);
            if (event) {
                event.preventDefault();
            }

            let searchQuery = '';
            switch (platform) {
                case 'youtube':
                    searchQuery = document.getElementById('youtubeSearch').value.trim();
                    break;
                case 'xiaohongshu':
                    searchQuery = document.getElementById('xiaohongshuSearch').value.trim();
                    break;
                case 'bilibili':
                    searchQuery = document.getElementById('bilibiliSearch').value.trim();
                    break;
            }

            if (!searchQuery) return;
            console.log("searchQuery:" + searchQuery);

            const encodedQuery = encodeURIComponent(searchQuery);
            let appUrl = '';
            let webUrl = '';

            // Only handle iOS devices
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                switch (platform) {
                    case 'youtube':
                        appUrl = `youtube://results?search_query=${encodedQuery}`;
                        webUrl = `https://www.youtube.com/results?search_query=${encodedQuery}`;
                        break;
                    case 'xiaohongshu':
                        appUrl = `xhsdiscover://search/result?keyword=${encodedQuery}`;
                        webUrl = `https://www.xiaohongshu.com/search_result?keyword=${encodedQuery}`;
                        break;
                    case 'bilibili':
                        appUrl = `bilibili://search?keyword=${encodedQuery}`;
                        webUrl = `https://search.bilibili.com/all?keyword=${encodedQuery}`;
                        break;
                }
                console.log("webUrl:" + webUrl);
                // Try to open the app first, with fallback to web if app is not installed
                tryOpenAppWithFallback(appUrl, webUrl);
            }
            else{
                console.log("Not on mobile platform")
                switch (platform) {
                    case 'youtube':
                        appUrl = `youtube://results?search_query=${encodedQuery}`;
                        webUrl = `https://www.youtube.com/results?search_query=${encodedQuery}`;
                        break;
                    case 'xiaohongshu':
                        appUrl = `xhsdiscover://search/result?keyword=${encodedQuery}`;
                        webUrl = `https://www.xiaohongshu.com/search_result?keyword=${encodedQuery}`;
                        break;
                    case 'bilibili':
                        appUrl = `bilibili://search?keyword=${encodedQuery}`;
                        webUrl = `https://search.bilibili.com/all?keyword=${encodedQuery}`;
                        break;
                }
                console.log("webUrl:" + webUrl);
                tryOpenAppWithFallback(webUrl, webUrl);
            }
        }

        function tryOpenAppWithFallback(appUrl, webUrl) {
            console.log("tryOpenAppWithFallback:", appUrl, webUrl);

            const wasHidden = document.hidden;
            let appOpened = false;

            const timeout = setTimeout(() => {
                if (!appOpened) {
                    console.log("appOpened Failed, fall back to web");
                    window.location.href = webUrl;  // use this instead of window.open
                }
            }, 2000);

            const handleVisibilityChange = () => {
                if (document.hidden && !wasHidden) {
                    appOpened = true;
                    clearTimeout(timeout);
                    document.removeEventListener('visibilitychange', handleVisibilityChange);
                }
            };

            document.addEventListener('visibilitychange', handleVisibilityChange);

            try {
                console.log("trying App opening");
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = appUrl;
                document.body.appendChild(iframe);

                setTimeout(() => {
                    if (document.body.contains(iframe)) {
                        document.body.removeChild(iframe);
                    }
                }, 100);

                setTimeout(() => {
                    if (!appOpened) {
                        window.location.href = appUrl;
                    }
                }, 500);
            } catch (error) {
                console.log("Exception fallback triggered");
                clearTimeout(timeout);
                window.location.href = webUrl;
            }
        }


        // Add event listeners for Enter key on each search input
        document.getElementById('youtubeSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch('youtube', e);
            }
        });

        document.getElementById('xiaohongshuSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch('xiaohongshu', e);
            }
        });

        document.getElementById('bilibiliSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch('bilibili', e);
            }
        });
    </script>
</body>
</html> 